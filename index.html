<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    
    <!-- CRITICAL: MOBILE-FRIENDLY VIEWPORT (Accessibility Compliant) -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes, viewport-fit=cover, shrink-to-fit=no" />
    
    <!-- iPhone specific meta tags -->
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="format-detection" content="telephone=no" />
    
    <!-- PWA Optimization -->
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="HandheldFriendly" content="true" />
    
    <base href="/" />

    <title>The Newel â€¢ 21st Century Science Learning Platform</title>
    
    <!-- Performance Monitoring -->
    <script>
      // Detect and optimize for older devices (2016-2018)
      (function() {
        const oldDevicePatterns = [
          /Android 6|Android 7/, // 2016-2017
          /iPhone OS 10|iPhone OS 11/, // 2016-2017
          /SamsungBrowser\/[1-5]/, // Old Samsung browsers
          /Opera Mini/, // Feature phones
          /BlackBerry/, // Legacy devices
        ];
        
        const userAgent = navigator.userAgent || navigator.vendor || window.opera;
        const isOldDevice = oldDevicePatterns.some(pattern => pattern.test(userAgent));
        const isMobile = /Mobi|Android/i.test(userAgent);
        const memory = navigator.deviceMemory || 4; // Default to 4GB if unknown
        
        if (isOldDevice || memory < 2) {
          document.documentElement.classList.add('old-device');
          console.log('ðŸ“± Old/low-memory device detected - optimizing performance');
          
          // Create optimization styles
          const style = document.createElement('style');
          style.textContent = `
            .old-device * {
              animation-duration: 0.01ms !important;
              animation-iteration-count: 1 !important;
              transition-duration: 0.01ms !important;
            }
            .old-device .cyber-box-glow,
            .old-device .cyber-text-glow,
            .old-device .animate-pulse,
            .old-device .animate-float,
            .old-device .animate-fade-in,
            .old-device .animate-fade-in-up {
              animation: none !important;
            }
            .old-device .space-icon,
            .old-device .constellation,
            .old-device .rocket,
            .old-device .cyber-grid,
            .old-device .matrix-column {
              display: none !important;
            }
          `;
          document.head.appendChild(style);
        }
        
        // Store device info for React
        window.deviceInfo = {
          isOldDevice,
          isMobile,
          memory,
          userAgent: userAgent.substring(0, 120)
        };
      })();
    </script>

    <!-- SPA Redirect Handler for 404.html -->
    <script>
      // Handle redirects from 404.html for SPA routing
      (function() {
        let redirect = sessionStorage.redirect;
        delete sessionStorage.redirect;
        if (redirect && redirect !== location.pathname) {
          history.replaceState(null, null, redirect);
        }
      })();
    </script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Pacifico&family=Share+Tech+Mono&family=Poppins:wght@400;500;600;700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    
    <!-- Mobile CSS (Load First) -->
    <style>
      /* ===== MOBILE OPTIMIZATION BASE STYLES ===== */
      * {
        -webkit-tap-highlight-color: transparent;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        text-rendering: optimizeLegibility;
      }
      
      /* Minimum touch target size (Apple Human Interface Guidelines) */
      button, 
      a[role="button"], 
      .mobile-tap-target {
        min-height: 44px !important;
        min-width: 44px !important;
      }
      
      /* Prevent iOS text size adjustment */
      html {
        -webkit-text-size-adjust: 100%;
        -ms-text-size-adjust: 100%;
        text-size-adjust: 100%;
      }
      
      /* Smooth scrolling for iOS */
      * {
        -webkit-overflow-scrolling: touch;
      }
      
      /* Safe area support for iPhone X+ */
      .safe-top { padding-top: env(safe-area-inset-top, 0px); }
      .safe-bottom { padding-bottom: env(safe-area-inset-bottom, 0px); }
      .safe-left { padding-left: env(safe-area-inset-left, 0px); }
      .safe-right { padding-right: env(safe-area-inset-right, 0px); }
      
      /* Mobile typography optimizations */
      @media (max-width: 768px) {
        body {
          font-size: 16px !important; /* Prevent iOS zoom on input focus */
          line-height: 1.6 !important;
        }
        
        input, textarea, select {
          font-size: 16px !important; /* Prevent iOS zoom */
        }
        
        /* Disable heavy animations on mobile for better performance */
        .animate-fade-in,
        .animate-fade-in-up,
        .animate-float,
        .animate-pulse {
          animation: fadeIn 0.5s ease-in-out !important; /* Simplified */
        }
        
        .cyber-box-glow,
        .cyber-text-glow {
          animation: none !important;
          text-shadow: 0 0 5px currentColor !important;
          box-shadow: 0 0 10px currentColor !important;
        }
      }
    </style>
    
    <!-- Custom Animations (Performance Optimized) -->
    <script>
      tailwind.config = {
        theme: {
          extend: {
            animation: {
              'fade-in': 'fadeIn 0.5s ease-in-out',
              'fade-in-up': 'fadeInUp 0.5s ease-out',
              'twinkle': 'twinkle 3s ease-in-out infinite',
              'float': 'float 6s ease-in-out infinite',
              'pulse': 'pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite',
              'theme-switch': 'themeSwitch 0.5s ease-out',
              'scan': 'scan 3s linear infinite',
              'bounce-slow': 'bounce 3s infinite',
            },
            keyframes: {
              fadeIn: { '0%': { opacity: '0' }, '100%': { opacity: '1' } },
              fadeInUp: { '0%': { opacity: '0', transform: 'translateY(20px)' }, '100%': { opacity: '1', transform: 'translateY(0)' } },
              twinkle: { '0%, 100%': { opacity: '1', transform: 'scale(1)' }, '50%': { opacity: '0.3', transform: 'scale(0.8)' } },
              float: { '0%, 100%': { transform: 'translateY(0px)' }, '50%': { transform: 'translateY(-10px)' } },
              themeSwitch: { '0%': { opacity: '0', transform: 'translateY(-10px)' }, '100%': { opacity: '1', transform: 'translateY(0)' } },
              scan: { '0%': { transform: 'translateY(-100%)' }, '100%': { transform: 'translateY(100vh)' } }
            }
          }
        }
      }
    </script>
    
    <style>
      /* ===== BASE STYLES ===== */
      body { 
        margin: 0; 
        padding: 0; 
        min-height: 100vh; 
        font-family: 'Inter', sans-serif; 
        transition: background 0.5s ease; 
        overflow-x: hidden;
        position: relative;
      }
      
      #root { 
        position: relative; 
        z-index: 100;
        min-height: 100vh;
        background: transparent !important;
      }

      /* ===== THEME ELEMENT CONTAINER ===== */
      .theme-elements-container {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 1;
        pointer-events: none;
        overflow: hidden;
      }

      /* ===== COSMIC THEME ===== */
      .cosmic-bg { 
        background: #000000 !important; 
        position: relative;
        overflow-x: hidden;
        min-height: 100vh;
        color: white !important;
      }
      
      .cosmic-bg::before {
        content: '';
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: 
          radial-gradient(circle at 20% 30%, rgba(138, 43, 226, 0.15) 0%, transparent 50%),
          radial-gradient(circle at 80% 70%, rgba(30, 144, 255, 0.15) 0%, transparent 50%);
        z-index: 1;
        pointer-events: none;
      }
      
      /* Star Field (Simplified for mobile) */
      .star-field {
        position: absolute !important;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 2;
        pointer-events: none;
        display: none;
      }
      
      .star {
        position: absolute;
        width: 2px;
        height: 2px;
        background: white;
        border-radius: 50%;
        box-shadow: 0 0 3px rgba(255, 255, 255, 0.8);
        animation: twinkle 3s ease-in-out infinite;
      }
      
      /* Floating Space Icons (Minimal for mobile) */
      .space-icon {
        position: absolute;
        font-size: 20px;
        z-index: 2;
        pointer-events: none;
        animation: float 8s ease-in-out infinite;
        opacity: 0.2;
      }
      
      /* ===== CYBER-DYSTOPIAN THEME ===== */
      .cyber-bg {
        background: #000000 !important;
        position: relative;
        overflow-x: hidden;
        min-height: 100vh;
        font-family: 'Share Tech Mono', monospace !important;
        color: #00ff41 !important;
      }
      
      .cyber-bg * {
        font-family: 'Share Tech Mono', monospace !important;
      }
      
      /* Cyber Grid (Lightweight for mobile) */
      .cyber-grid {
        position: absolute !important;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-image: 
          linear-gradient(rgba(0, 255, 65, 0.03) 1px, transparent 1px),
          linear-gradient(90deg, rgba(0, 255, 65, 0.03) 1px, transparent 1px);
        background-size: 60px 60px; /* Larger grid for performance */
        z-index: 2;
        pointer-events: none;
        display: none;
      }
      
      /* ===== CYBER TEXT & BOX GLOW (Performance Optimized) ===== */
      .cyber-text-glow {
        text-shadow: 
          0 0 5px rgba(0, 255, 65, 0.8),
          0 0 10px rgba(0, 255, 65, 0.4);
      }
      
      .cyber-box-glow {
        box-shadow: 
          0 0 10px rgba(0, 255, 65, 0.3),
          inset 0 0 10px rgba(0, 255, 65, 0.1);
        border: 1px solid rgba(0, 255, 65, 0.5);
      }

      /* ===== MOBILE-SPECIFIC OPTIMIZATIONS ===== */
      @media (max-width: 768px) {
        /* Hide complex theme elements on mobile for performance */
        .star-field,
        .constellation,
        .rocket,
        .rocket-exhaust,
        .asteroid,
        .saturn,
        .cyber-grid,
        .cyber-scanline,
        .matrix-column,
        .space-icon {
          display: none !important;
        }
        
        /* Simplify gradients for mobile */
        .cosmic-bg::before {
          opacity: 0.3;
        }
        
        /* Adjust glow effects for mobile */
        .cyber-text-glow {
          text-shadow: 0 0 8px currentColor;
        }
        
        .cyber-box-glow {
          box-shadow: 0 0 10px currentColor;
        }
        
        /* Touch-friendly adjustments */
        button, a[role="button"] {
          padding: 12px 16px !important;
        }
        
        /* Better readability */
        h1 { font-size: 2rem !important; }
        h2 { font-size: 1.75rem !important; }
        h3 { font-size: 1.5rem !important; }
        p, span, li { font-size: 16px !important; line-height: 1.6 !important; }
      }
      
      /* Extra small devices */
      @media (max-width: 360px) {
        h1 { font-size: 1.75rem !important; }
        h2 { font-size: 1.5rem !important; }
        .text-2xl { font-size: 1.25rem !important; }
        
        /* Even simpler gradients */
        .cosmic-bg::before {
          opacity: 0.2;
        }
      }
      
      /* Tablet optimizations */
      @media (min-width: 769px) and (max-width: 1024px) {
        .space-icon { font-size: 24px; opacity: 0.3; }
        .cyber-grid { background-size: 40px 40px; }
      }
    </style>
    
    <!-- 33 Neuroscience Facts -->
    <script>
      // 33 Neuroscience Facts - Optimized loading
      const neuroscienceFacts = [
        "The human brain has about 86 billion neurons.",
        "Sleep is crucial for memory consolidation.",
        "Neuroplasticity allows your brain to reorganize itself.",
        "Exercise increases BDNF, boosting learning.",
        "Multitasking reduces learning efficiency by up to 40%.",
        "The brain processes images 60,000 times faster than text.",
        "Meditation increases gray matter density.",
        "The spacing effect beats cramming for long-term retention.",
        "Dopamine creates 'reward pathways' for knowledge.",
        "Bilingual brains delay dementia onset by 5 years.",
        "Music training enhances auditory processing.",
        "Smell is directly wired to emotions and memory.",
        "Lack of sleep impairs prefrontal cortex function.",
        "Omega-3 fatty acids maintain neuronal membrane fluidity.",
        "The gut-brain axis affects mood via neurotransmitters.",
        "Blueberries enhance memory.",
        "Learning in 90-minute intervals aligns with ultradian rhythms.",
        "The 'testing effect' boosts memory more than re-studying.",
        "Emotional arousal enhances memory consolidation.",
        "Chronic pain physically rewires neural pathways.",
        "Laughter increases endorphins and dopamine.",
        "The brain uses 20% of the body's oxygen.",
        "Stress physically changes brain structure.",
        "Your brain generates about 20 watts of electricity.",
        "The brain is 73% water.",
        "Learning new skills increases myelin.",
        "The prefrontal cortex develops until age 25.",
        "Blue light suppresses melatonin.",
        "The default mode network activates during creativity.",
        "Chronic stress kills brain cells.",
        "The brain's visual cortex dedicates 30% to facial recognition.",
        "The cerebellum contains 50% of the brain's neurons.",
        "Chronic inflammation reduces new neuron creation."
      ];

      window.neuroscienceFacts = neuroscienceFacts;
      
      // Initialize function
      window.initNeuroscienceFacts = function() {
        return neuroscienceFacts;
      };
    </script>

    <!-- Enhanced Theme Manager (Mobile Optimized) -->
    <script>
      class ThemeManager {
        constructor() {
          this.currentTheme = null;
          this.initialized = false;
          this.spaceIcons = [];
          this.themeContainer = null;
          this.isMobile = /Mobi|Android/i.test(navigator.userAgent);
          this.isOldDevice = document.documentElement.classList.contains('old-device');
        }
        
        initialize() {
          if (this.initialized) return;
          
          this.createThemeContainer();
          this.createThemeElements();
          this.initialized = true;
        }
        
        createThemeContainer() {
          this.themeContainer = document.createElement('div');
          this.themeContainer.className = 'theme-elements-container';
          document.body.appendChild(this.themeContainer);
        }
        
        createThemeElements() {
          if (!this.themeContainer) return;
          
          // Only create minimal elements for mobile
          if (!this.isMobile && !this.isOldDevice) {
            if (!document.querySelector('.star-field')) {
              const starField = document.createElement('div');
              starField.className = 'star-field';
              this.themeContainer.appendChild(starField);
            }
            
            if (!document.querySelector('.cyber-grid')) {
              const cyberGrid = document.createElement('div');
              cyberGrid.className = 'cyber-grid';
              this.themeContainer.appendChild(cyberGrid);
            }
          }
        }
        
        setTheme(theme) {
          const body = document.body;
          
          body.classList.remove('cosmic-bg', 'cyber-bg', 'text-white', 'text-green-500');
          
          this.hideAllThemeElements();
          document.querySelectorAll('.matrix-column').forEach(el => el.remove());
          this.cleanupSpaceIcons();
          
          if (theme === 'Cosmic') {
            body.classList.add('cosmic-bg', 'text-white');
            body.style.fontFamily = "'Inter', sans-serif";
            if (!this.isMobile && !this.isOldDevice) {
              this.showCosmicElements();
            }
          } else if (theme === 'Cyber-Dystopian') {
            body.classList.add('cyber-bg', 'text-green-500');
            body.style.fontFamily = "'Share Tech Mono', 'Inter', monospace";
            if (!this.isMobile && !this.isOldDevice) {
              this.showCyberElements();
            }
          }
          
          this.currentTheme = theme;
        }
        
        hideAllThemeElements() {
          const elements = document.querySelectorAll(
            '.star-field, .constellation, .rocket, .rocket-exhaust, .asteroid, .saturn, .cyber-grid, .cyber-scanline, .space-icon'
          );
          elements.forEach(el => {
            if (el) el.style.display = 'none';
          });
        }
        
        showCosmicElements() {
          const starField = document.querySelector('.star-field');
          if (starField) {
            starField.innerHTML = '';
            // Reduced star count for performance
            for (let i = 0; i < 80; i++) {
              const star = document.createElement('div');
              star.className = 'star';
              star.style.left = `${Math.random() * 100}%`;
              star.style.top = `${Math.random() * 100}%`;
              star.style.animationDelay = `${Math.random() * 3}s`;
              starField.appendChild(star);
            }
            starField.style.display = 'block';
          }
        }
        
        cleanupSpaceIcons() {
          this.spaceIcons.forEach(icon => {
            if (icon && icon.parentNode) {
              icon.parentNode.removeChild(icon);
            }
          });
          this.spaceIcons = [];
        }
        
        showCyberElements() {
          const cyberGrid = document.querySelector('.cyber-grid');
          if (cyberGrid) {
            cyberGrid.style.display = 'block';
          }
        }
      }
      
      const themeManager = new ThemeManager();
      
      document.addEventListener('DOMContentLoaded', () => {
        themeManager.initialize();
      });
      
      // Optimized resize handler
      let resizeTimeout;
      window.addEventListener('resize', () => {
        clearTimeout(resizeTimeout);
        resizeTimeout = setTimeout(() => {
          if (themeManager.currentTheme === 'Cyber-Dystopian' && !themeManager.isMobile) {
            // Simplified resize handling
          }
        }, 500); // Longer delay for mobile
      });

      window.ThemeManager = themeManager;
      
      window.addEventListener('load', () => {
        console.log('ðŸš€ The Newel Platform Initialized');
        console.log('ðŸ“± Device:', window.deviceInfo);
      });
    </script>
  </head>
  
  <body>
    <div id="root" class="main-content"></div>
    
    <script type="module" src="/index.tsx"></script>
    
    <!-- Mobile Performance Script -->
    <script>
      // Additional mobile optimizations
      document.addEventListener('touchstart', function() {}, {passive: true});
      
      // Prevent double-tap zoom
      let lastTouchEnd = 0;
      document.addEventListener('touchend', function(event) {
        const now = (new Date()).getTime();
        if (now - lastTouchEnd <= 300) {
          event.preventDefault();
        }
        lastTouchEnd = now;
      }, false);
      
      // Load CSS for older devices
      if (window.deviceInfo && window.deviceInfo.isOldDevice) {
        const oldDeviceCSS = `
          .mobile-tap-target { padding: 14px 18px !important; }
          .text-5xl { font-size: 2rem !important; }
          .text-4xl { font-size: 1.75rem !important; }
          .grid-cols-3, .grid-cols-2 { grid-template-columns: 1fr !important; }
          .p-10 { padding: 1.5rem !important; }
          .space-y-6 > * + * { margin-top: 1rem !important; }
        `;
        const style = document.createElement('style');
        style.textContent = oldDeviceCSS;
        document.head.appendChild(style);
      }
    </script>
  </body>
</html>